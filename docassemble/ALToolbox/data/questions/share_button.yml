---
metadata:
  title: Share some text button
---
modules:  
  - .share_button
---
mandatory: True
question: |
  Share button
# May be more robust to use Bootstrap tooltip (needs popper.js): https://getbootstrap.com/docs/4.1/components/tooltips/
fields:
  - note: |
      <div class="al_share">
      <input readonly class="al_share_value" type="text" value="${ interview_url(i=user_info().filename, style="short", new_session=1) } 1">
      <button class="btn btn-primary al_share_button" type="button">
        <span class="al_tooltip al_tooltip_inert">Copy to clipboard</span>
        <span class="al_tooltip al_tooltip_active">Copied: ${ interview_url(i=user_info().filename, style="short", new_session=1) }</span>
        <i class="far fa-copy"></i>
        <span>Copy the link</span>
      </button>
      </div>
      
      ${ share_button( interview_url(i=user_info().filename, style="short", new_session=1) ) }
      
      ${ share_button( "some text", text_before="Text before: ", label="Copy this text", tooltip_inert_text="Best tooltip", tooltip_copied_text="I'm copied!"  ) }
      
script: |
  <script>
    try {
      var share_nodes = document.getElementsByClassName('al_share');

      for ( var node_i = 0; node_i < share_nodes.length; node_i++ ) {
        add_share_event_listeners( $(share_nodes[ node_i ]) );
      }

      function add_share_event_listeners( $node ) {
        var input = $node.find('.al_share_value')[0];
        var $button = $node.find('.al_share_button').eq(0);
        var $tooltip_inert = $node.find('.al_tooltip_inert').eq(0);
        var $tooltip_active = $node.find('.al_tooltip_active').eq(0);
        
        $button.on( 'mouseenter', function ( event ) {
          try {
            $tooltip_inert.show()
            $tooltip_active.hide()
            
          } catch ( error ) {
            console.warn( 'Error in AL share button mouseenter' );
            console.warn( error );
          }
        });
        
        $button.on( 'click', function ( event ) {
          try {
            input.focus();
            input.select();
            document.execCommand("copy");
            
            $tooltip_inert.hide()
            $tooltip_active.show()
            input.blur();
            
          } catch ( error ) {
            console.warn( 'Error in AL share button click' );
            console.warn( error );
          }
        });
        
        $button.on( 'mouseleave', function ( event ) {
          try {
            $tooltip_inert.hide()
            $tooltip_active.hide()
            
          } catch ( error ) {
            console.warn( 'Error in AL share button mouseleave' );
            console.warn( error );
          }
        });
      }
    } catch ( error ) {
      console.warn( 'Error in AL share button');
      console.warn( error );
    }
  </script>
css: |
  <style>
  
  .al_share {
    margin-bottom: 1em;
  }
  
  .al_share_button {
    position: relative;
    vertical-align: bottom;
  }
  
  .al_visible_text {
    max-width: 100%;
    overflow-x: scroll;
  }

  .al_share_button .al_tooltip {
    visibility: hidden;
    max-width: 10em;
    background-color: #555;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px;
    position: absolute;
    z-index: 1;
    bottom: 150%;
    left: 50%;
    margin-left: -75px;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .al_share_button .al_tooltip::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #555 transparent transparent transparent;
  }

  .al_share_button:hover .al_tooltip {
    visibility: visible;
    opacity: 1;
  }
  </style>