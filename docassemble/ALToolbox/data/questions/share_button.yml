mandatory: True
question: |
  Share button
# May be more robust to use Bootstrap tooltip (needs popper.js): https://getbootstrap.com/docs/4.1/components/tooltips/
fields:
  - note: |
      <div class="al_share">
      <span>Copy and share this link</span>
      <input type="text" value="${ interview_url(i=user_info().filename, style="short", new_session=1) }"  class="al_share_value">
      <span class="copy-tooltip al_share_button_container">
      <button class="btn btn-primary al_share_button" type="button">
        <span class="tooltiptext al_tooltip">Copy to clipboard</span>
        <i class="far fa-copy"></i>
      </button>
      </span>
      </div>
      
      <div class="al_share">
      <span>Copy and share this second link</span>
      <input type="text" value="some text"  class="al_share_value">
      <span class="copy-tooltip al_share_button_container">
      <button class="btn btn-primary al_share_button" type="button">
        <span class="tooltiptext al_tooltip">Copy to clipboard</span>
        <i class="far fa-copy"></i>
      </button>
      </span>
      </div>
script: |
  <script>
    try {
      var share_nodes = document.getElementsByClassName('al_share');

      for ( var node_i = 0; node_i < share_nodes.length; node_i++ ) {
        add_share_event_listeners( $(share_nodes[ node_i ]) );
      }

      function add_share_event_listeners( $node ) {
        var input = $node.find('.al_share_value')[0];
        var $container = $node.find('.al_share_button_container').eq(0);
        var $tooltip = $node.find('.al_tooltip').eq(0);
        
        $container.on( 'click', function ( event ) {
          try {
            input.focus();
            input.select();
            document.execCommand("copy");
            $tooltip.html( "Copied: " + input.value );
            
            input.blur();
            
          } catch ( error ) {
            console.warn( 'Error in AL share button click');
            console.warn( error );
          }
        });
        
        $container.on( 'mouseout', function ( event ) {
          try {
            console.log($tooltip)
            $tooltip.html( 'Copy to clipboard' );
            
          } catch ( error ) {
            console.warn( 'Error in AL share button mouseout');
            console.warn( error );
          }
        });
      }
    } catch ( error ) {
      console.warn( 'Error in AL share button');
      console.warn( error );
    }
  </script>
css: |
  <style>
  .al_share_button_container {
    vertical-align: bottom;
  }
  
  .al_share_value {
    pointer-events: none;
  }
  
  .copy-tooltip {
    position: relative;
  }

  .copy-tooltip .tooltiptext {
    visibility: hidden;
    max-width: 10em;
    background-color: #555;
    color: #fff;
    text-align: center;
    border-radius: 6px;
    padding: 5px;
    position: absolute;
    z-index: 1;
    bottom: 150%;
    left: 50%;
    margin-left: -75px;
    opacity: 0;
    transition: opacity 0.3s;
  }

  .copy-tooltip .tooltiptext::after {
    content: "";
    position: absolute;
    top: 100%;
    left: 50%;
    margin-left: -5px;
    border-width: 5px;
    border-style: solid;
    border-color: #555 transparent transparent transparent;
  }

  .copy-tooltip:hover .tooltiptext {
    visibility: visible;
    opacity: 1;
  }
  </style>