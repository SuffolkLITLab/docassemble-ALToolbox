---
include:
  - goal_oriented_question_structured.yml
---
metadata:
  title: Legal Aid Intake - Goal-Oriented Questions Demo (Structured or Unstructured)
  short title: Flexible Intake Demo
  description: |
    This interview demonstrates using GoalOrientedQuestionList with either
    a structured initial question (using radio buttons, checkboxes, etc.)
    or an open-ended narrative response. You can choose the format that works
    best for your use case.
---
objects:
  - housing_intake: GoalOrientedQuestionList.using(
                    rubric="The response provides complete information about the tenant's housing situation, including the type of issue, timeline, communication with landlord, and any immediate safety or habitability concerns.",
                    initial_question="We need to understand your housing situation to determine how we can help. Please provide information about your housing issue.",
                    llm_assumed_role="housing intake specialist", 
                    user_assumed_role="tenant seeking help",
                    model=model,
                    reasoning_effort=reasoning_effort,
                    skip_moderation=skip_moderation,
                  )
---
mandatory: True
code: |
  intro_screen
  question_format_choice
  
  # Set the use_structured_initial_question based on user choice
  if question_format == "structured":
    housing_intake.use_structured_initial_question = True
    # Trigger the initial structured question
    housing_intake._initial_structured_complete
  else:
    housing_intake.use_structured_initial_question = False
    # Trigger the initial open-ended question
    housing_intake.initial_draft
  
  housing_intake.gather()
  final_response
  intake_summary
---
code: |
  if len(housing_intake):
    final_response_default = housing_intake.synthesize_draft_response()
  else:
    final_response_default = housing_intake.initial_response_as_text()
---
code: |
  # This code block is needed to define the question_format_choice step
  question_format_choice = True
---
continue button field: intro_screen
question: |
  Welcome to Housing Legal Aid Intake
subquestion: |
  This demo shows how the **GoalOrientedQuestionList** can use structured
  fields (radio buttons, checkboxes, etc.) or an open-ended narrative for 
  the initial question.
  
  #### Scenario
  
  You are seeking help with a housing issue. An intake worker needs to understand
  your situation to determine if you qualify for services and to prepare for
  your initial consultation.
  
  #### How it works:
  
  1. You'll choose between a structured form or an open-ended question
  2. You'll provide information about your housing situation
  3. The AI will evaluate your response to see if it provides enough detail
  4. If more information is needed, you'll get follow-up questions
  5. Your responses will be synthesized into a complete intake summary
  
  This approach allows you to choose the most appropriate format for data collection.
---
question: |
  Choose your initial question format
subquestion: |
  How would you like to provide information about your housing situation?
fields: 
  - Question format: question_format
    datatype: radio
    choices:
      - Structured form with specific fields (AI-generated): structured
      - Open-ended narrative response: unstructured
  - Reasoning effort: reasoning_effort
    datatype: radio
    choices:
      - Minimal: minimal
      - Low effort (faster responses, less depth): low
      - Medium effort (balanced speed and depth): medium
      - High effort (more thoughtful responses, slower): high
  - Skip moderation: skip_moderation
    datatype: yesnoradio
    default: True
  - Model: model
    datatype: radio
    choices:
      - gpt-4.1-nano
      - gpt-5-nano
      - gpt-5-mini
---
question: |
  Tell us about your housing situation
subquestion: |
  To help us prepare for your consultation, please tell us about your housing issue.
  
  You can describe:
  
  * What type of problem you're having (repairs, eviction, etc.)
  * When the issue started
  * What you've tried to do about it
  * Any communication with your landlord
  * Whether there are safety or health concerns
  
  Don't worry if you're not sure what's importantâ€”just tell us about your 
  situation in your own words.
fields:
  - Your response: housing_intake.initial_draft
    datatype: area
    rows: 8
---
question: |
  Review your intake information
subquestion: |
  % if len(housing_intake):
  Based on your responses, we've prepared this summary of your situation.
  Please review it and make any corrections or additions before we finalize
  your intake information.

  ${ collapse_template(housing_intake.show_current_progress) }
  % else:
  Here is the information you provided. You can make any edits before we finalize
  your intake.
  % endif
fields:
  - Intake summary: final_response
    datatype: area
    rows: 10
    default: |
      ${ final_response_default }
---
event: intake_summary
question: |
  Intake completed
subquestion: |
  Thank you for providing this information. Your intake summary is ready
  for the intake worker to review before your consultation.
  
  #### Intake Summary
  
  > ${ final_response }
  
  % if len(housing_intake):
  #### Your Conversation
  
  ${ collapse_template(housing_intake.show_current_progress) }
  
  % endif
  
  #### Next Steps
  
  An intake worker will review this information and contact you to determine
  if we can help with your housing issue.
  
  ---
  
  #### About this demo
  
  This demo used a **GoalOrientedQuestionList** with:
  
  * **Initial question format**: ${ "Structured fields (generated by AI)" if question_format == "structured" else "Open-ended narrative" }
  * **Question limit**: ${ housing_intake.question_limit } follow-up questions maximum
  * **Follow-ups asked**: ${ len(housing_intake) }
  * **Sufficient information gathered**: ${ "Yes" if housing_intake.satisfied() else "Partially" }
  * **Model**: ${ housing_intake.model }
  * **LLM role**: ${ housing_intake.llm_assumed_role }
  * **User role**: ${ housing_intake.user_assumed_role }
  
  The AI ${ "generated structured fields for the initial question and then" if question_format == "structured" else "" } asked follow-ups until the response met this rubric:
  
  > ${ housing_intake.rubric }
buttons:
  - Exit: exit
  - Restart: restart
